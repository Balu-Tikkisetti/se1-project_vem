<!DOCTYPE html>
<html>
<head>
  <title>Manager Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 100px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
    }

    .header {
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 20px;
    }

    .content {
      margin: 20px;
    }

    .content h2 {
      margin-bottom: 10px;
    }

    header {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .profile-button {
      position: relative;
      display: inline-block;
      cursor: pointer;
      padding: 8px 12px;
      background-color: #f2f2f2;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }
    .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    z-index: 999;
  }
  .overlay-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    max-width: 400px;
    width: 100%;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }

  .overlay h2 {
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 24px;
  }

  .overlay label {
    display: block;
    margin-bottom: 10px;
  }
  .overlay input,
  .overlay select,
  .overlay textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 10px;
  }
  .submit-button,
  .cancel-button {
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  .submit-button {
    background-color: #4CAF50;
    color: white;
    margin-right: 10px;
  }

  .cancel-button {
    background-color: #ccc;
    color: #333;
  }
  .submit-button:hover,
  .cancel-button:hover {
    background-color: #45a049;
  }

    .profile-button:hover {
      background-color: #e0e0e0;
    }

    .profile-dropdown {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 120px;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .profile-dropdown a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .profile-dropdown a:hover {
      background-color: #f1f1f1;
    }

    .profile-button:hover .profile-dropdown {
      display: block;
    }

    .navigation {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 20px;
    }

    .navigation a {
      margin-right: 10px;
      text-decoration: none;
      color: #333;
      padding: 8px 12px;
      border-radius: 4px;
      background-color: #f2f2f2;
      transition: background-color 0.3s ease;
    }

    .navigation a:hover {
      background-color: #e0e0e0;
    }

    .content {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 5px;
      display: none;
    }

    .content.active {
      display: block;
    }

    h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .account-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .account-overlay.active {
      display: flex;
    }

    .account-form {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      max-width: 400px;
      width: 100%;
    }

    .account-form h3 {
      margin-top: 0;
      margin-bottom: 20px;
    }

    .account-form label {
      display: block;
      margin-bottom: 10px;
    }

    .account-form input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .account-form button {
      background-color: #4CAF50;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .account-form button:hover {
      background-color: #45a049;
    }

    .account-form .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      color: #ccc;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="profile-button">
        Profile
        <div class="profile-dropdown">
          <a href="#" onclick="showAccountOverlay()">Account</a>
          <a href="{{ url_for('logout') }}">Logout</a>
        </div>
      </div>
    </header>

    <div class="navigation">
      <a href="#" onclick="showContent('events')">Events</a>
      <a href="#" onclick="showContent('my-events')">My Events</a>
      <a href="#" onclick="showContent('Volunteers')">Volunteers</a>
      <a href="#" onclick="showContent('notifications')">Notifications</a>
      
      
    </div>

    <div class="content" id="Volunteers">
      <h2>Volunteers</h2>
      <table>
        <thead>
          <tr>
            <th>Volunteer Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="volunteers-table-body">
          <!-- The table content will be dynamically filled by the JavaScript code -->
        </tbody>
      </table>
    </div>
    

    <div class="content" id="notifications">
      <h2>Notifications</h2>
      <table>
        <thead>
          <tr>
            <th>Event Name</th>
            <th>Volunteer Name</th>
          </tr>
        </thead>
        <tbody id="notifications-table-body">
          <!-- Notifications will be dynamically filled here -->
        </tbody>
      </table>
    </div>
    

    <div class="content" id="events">
      <h2>Events</h2>
      <ul>
        {% for event in all_events %}
          <li>Name:{{ event.event_name }}</li>
          <p>Description:{{ event.event_description }}</p>
          <p>Time: {{ event.event_time }}</p>
          <p>Duration: {{ event.event_duration }}</p>
          <p>Required Skills: {{ ', '.join(event.required_skills) }}</p>
          <p>Event Venue:{{ event.event_venue}}</p>
          <hr>
        {% endfor %}
      </ul>
    </div>

    <div class="content" id="my-events">
      <h2>My Events</h2>
      <table>
        <thead>
          <tr>
            <th>Event Name</th>
            <th>Event Description</th>
            <th>Event Time</th>
            <th>Event Duration</th>
            <th>Required Skills</th>
            <th>Matched Volunteers</th>
          </tr>
        </thead>
        <tbody id="my-events-table-body">
          {% for event in my_events %}
          <tr>
            <td>{{ event.event_name }}</td>
            <td>{{ event.event_description }}</td>
            <td>{{ event.event_time }}</td>
            <td>{{ event.event_duration }}</td>
            <td>{{ event.required_skills }}</td>
            <td>
              <ul>
                {% for volunteer in event.matched_volunteers %}
                <li>
                  {{ volunteer.name }} ({{ volunteer.available_time }})
                  <div class="status-bar {{ volunteer.status }}">
                    {{ volunteer.status }}
                  </div>
                </li>
                {% endfor %}
              </ul>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button onclick="showCreateEventFormOverlay()">+ Add Event</button>
      <div class="overlay" id="create-event-overlay">
        <div class="overlay-content">
          <h2>Create Event</h2>
          <form id="create-event-form" method="POST">
            <label for="event_name">Event Name:</label>
            <input type="text" id="event_name" name="event_name" required><br>
      
            <label for="event_description">Event Description:</label>
            <textarea id="event_description" name="event_description" required></textarea><br>
            
            <label for="event_time">Event Time:</label>
            <select id="event_time" name="event_time" required>
              <option value="9AM-12PM">9.00 AM - 12.00 PM</option>
              <option value="2PM-5PM">2.00 PM - 5.00 PM</option>
              <option value="6PM-10PM">6.00 PM - 10.00 PM</option>
            </select><br>
      
            <label for="event_duration">Event Duration:</label>
            <input type="text" id="event_duration" name="event_duration" required><br>
      
            <label for="event_venue">Event Venue:</label>
            <input type="text" id="event_venue" name="event_venue" required><br>
      
            <label for="required_skills">Required Skills:</label>
            <select id="required_skills" name="required_skills" multiple>
              <option value="Creativity">Creativity</option>
              <option value="Communication">Communication</option>
              <option value="Mindfulness">Mindfulness</option>
              <option value="Metaconfigation">Metaconfigation</option>
              <option value="Leadership skills">Leadership skills</option>
              <option value="Fortitude">Fortitude</option>
              <option value="Metacognition">Metacognition</option>
              <option value="Coding skills">Coding skills</option>
              <option value="Sports">Sports</option>
              <option value="Reporting">Reporting</option>
              <option value="Time MAnagement">Time Management</option>
              <option value="Interpersonal SKills">Interpersonal Skills</option>
            </select><br>
      
            <input type="submit" value="Create Event">
            <button onclick="hideCreateEventFormOverlay()">Cancel</button>
          </form>
        </div>
      </div>
      
           
    </div>
    


    <div class="account-overlay" id="account-overlay">
      <div class="account-form">
        <label for="manager_username">Username:</label>
        <input type="text" id="manager_username" value="" disabled><br>
    
        <label for="manager_email">Email:</label>
        <input type="email" id="manager_email" value="" disabled><br>
    
        <label for="manager_password">Password:</label>
        <input type="text" id="manager_password" value="" disabled><br>
    
        <button class="close-button" onclick="hideAccountOverlay()">&times;</button>
      </div>
    </div>

    <script>


  // Extract the user ID from the URL
  const urlParts = window.location.href.split('/');
  const user_id = urlParts[urlParts.length - 1].replace("#", "");

  managerUserId=user_id;

      function showContent(contentId) {
        var contentSections = document.getElementsByClassName('content');
        for (var i = 0; i < contentSections.length; i++) {
          contentSections[i].classList.remove('active');
        }
        var selectedContent = document.getElementById(contentId);
        selectedContent.classList.add('active');
      }
// Show the Create Event form overlay
function showCreateEventFormOverlay() {
  const createEventOverlay = document.getElementById('create-event-overlay');
  createEventOverlay.style.display = 'block';
}


function hideCreateEventFormOverlay() {
  const createEventOverlay = document.getElementById('create-event-overlay');
  createEventOverlay.style.display = 'none';
}

const createEventForm = document.getElementById('create-event-form');
const requiredSkillsSelect = document.getElementById('required_skills');
createEventForm.addEventListener('submit', function(event) {
  event.preventDefault(); // Prevent form submission

  // Get the selected skills
  const selectedSkills = Array.from(requiredSkillsSelect.options)
    .filter(option => option.selected)
    .map(option => option.value);

const eventTimeSelect = document.getElementById('event_time');
const selectedEventTime = eventTimeSelect.value;
  // Create the request body
  const requestBody = {
    event_name: createEventForm.event_name.value,
    event_description: createEventForm.event_description.value,
    event_time: selectedEventTime,
    event_duration: createEventForm.event_duration.value,
    event_venue: createEventForm.event_venue.value,
    required_skills: selectedSkills
  };


  fetch(`/create_event/${user_id}`, {
    method: 'POST',
    body: JSON.stringify(requestBody),
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => {
    if (response.ok) {
      // Event creation successful
      // You can perform any necessary actions here, such as showing a success message or redirecting the user
      console.log('Event created successfully!');
      createEventForm.reset();
      hideCreateEventFormOverlay();
    } else {
      // Event creation failed
      // You can handle the error condition here, such as displaying an error message to the user
      console.error('Failed to create event');
    }
  })
  .catch(error => {
    // Error occurred while creating the event
    console.error('An error occurred:', error);
  });
});





  

  


  function showAccountOverlay() {
        var accountOverlay = document.getElementById('account-overlay');
        accountOverlay.classList.add('active');
      }

      function hideAccountOverlay() {
        var accountOverlay = document.getElementById('account-overlay');
        accountOverlay.classList.remove('active');
      }

    const accountOverlay = document.getElementById('account-overlay');
  const managerUsernameInput = document.getElementById('manager_username');
  const managerEmailInput = document.getElementById('manager_email');
  const managerPasswordInput = document.getElementById('manager_password');

  fetch(`/get_manager_credentials/${user_id}`, {
    method: 'GET'
  })
  .then(response => response.json())
  .then(data => {
    managerUsernameInput.value = data.username;
    managerEmailInput.value = data.email;
    managerPasswordInput.value = data.password;
  })
  .catch(error => {
    console.error('An error occurred while fetching manager credentials:', error);
  });

  document.addEventListener('DOMContentLoaded', function() {
  const tableBody = document.getElementById("volunteers-table-body");

  fetch(`/get_volunteers`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ manager_id: managerUserId })
  })
    .then(response => response.json())
    .then(data => {
      // Get the volunteers from the response
      const volunteers = data.volunteers;

      // Get the manager's own events from the rendered HTML
      const events = document.getElementsByClassName("manager-event");

      // Clear existing table rows
      tableBody.innerHTML = "";

      // Loop through each volunteer
      volunteers.forEach(volunteer => {
        // Create a new row for the volunteer
        const newRow = tableBody.insertRow();

        // Volunteer Name column
        const volunteerNameCell = newRow.insertCell();
        volunteerNameCell.innerText = volunteer.firstname + " " + volunteer.lastname;

        // Email column
        const emailCell = newRow.insertCell();
        emailCell.innerText = volunteer.email;

        // Status column
        const statusCell = newRow.insertCell();
        const matchedEvent = volunteer.matched_event;
        statusCell.innerText = matchedEvent ? `Matched with ${matchedEvent}` : "Not Matched";

        // Action column
        const actionCell = newRow.insertCell();
        const volunteerId = volunteer.user_id;
        const sendRequestButton = document.createElement("button");
        sendRequestButton.textContent = "Send Request";
        sendRequestButton.addEventListener("click", () => sendRequest(managerUserId, volunteerId, sendRequestButton)); // Pass the button element
        actionCell.appendChild(sendRequestButton);
      });
    })
    .catch(error => console.error("Error fetching volunteers:", error));
})

// Function to send a request to a volunteer
function sendRequest(managerId, volunteerId, buttonElement) {
  const requestData = { manager_id: managerId, volunteer_id: volunteerId };
  
  fetch(`/send_request`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(requestData)
  })
  .then(response => response.json())
  .then(data => {
    alert(data.message);
    // Disable the button and change its text to "Request Sent"
    buttonElement.textContent = "Request Sent";
    buttonElement.disabled = true;
  })
  .catch(error => console.error("Error sending request:", error));
}



document.addEventListener('DOMContentLoaded', function() {
  const tableBody = document.getElementById("my-events-table-body");
  const managerUserId = "{{ user_id }}";

  fetch(`/get_manager_events/${managerUserId}`)
    .then(response => response.json())
    .then(data => {
      const myEvents = data.my_events;

      tableBody.innerHTML = "";

      myEvents.forEach(event => {
        const newRow = tableBody.insertRow();

        const eventNameCell = newRow.insertCell();
        eventNameCell.innerText = event.event_name;

        const eventDescCell = newRow.insertCell();
        eventDescCell.innerText = event.event_description;

        const eventTimeCell = newRow.insertCell();
        eventTimeCell.innerText = event.event_time;

        const eventDurationCell = newRow.insertCell();
        eventDurationCell.innerText = event.event_duration;

        const requiredSkillsCell = newRow.insertCell();
        requiredSkillsCell.innerText = event.required_skills;

        const matchedVolunteersCell = newRow.insertCell();
        const matchedVolunteersList = document.createElement("ul");

        event.matched_volunteers.forEach(volunteer => {
          const listItem = document.createElement("li");
          listItem.innerText = `${volunteer.name} (${volunteer.available_time})`;

          const statusBar = document.createElement("div");
          statusBar.classList.add("status-bar");
          statusBar.classList.add(volunteer.status.toLowerCase());
          statusBar.innerText = volunteer.status;

          listItem.appendChild(statusBar);
          matchedVolunteersList.appendChild(listItem);
        });

        matchedVolunteersCell.appendChild(matchedVolunteersList);
      });
    })
    .catch(error => console.error("Error fetching manager events:", error));
});





document.addEventListener('DOMContentLoaded', function () {
    const notificationsTableBody = document.getElementById('notifications-table-body');

    const managerUserId = user_id

    fetch(`/get_notifications/${managerUserId}`)
      .then(response => response.json())
      .then(data => {
        const notifications = data.notifications;

        notifications.forEach(notification => {
          const newRow = notificationsTableBody.insertRow();
          const eventNameCell = newRow.insertCell();
          const volunteerNameCell = newRow.insertCell();
          const Status=newRow.insertCell();

          eventNameCell.innerText = notification.event_name;
          volunteerNameCell.innerText = notification.volunteer_name;
          Status.innerText=notification.status;
        });
      })
      .catch(error => console.error('Error fetching notifications:', error));
  });




    </script>
  </div>
</body>
</html>
