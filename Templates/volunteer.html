<!DOCTYPE html>
<html>
<head>
  <title>Volunteer Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 100px;
    }

    .applied {
        background-color: #ccc; /* Change to the desired style for the 'Applied' state */
        color: #fff; /* Change to the desired text color for the 'Applied' state */
        cursor: not-allowed; /* Optional: To show that the button is disabled */
    }



    header {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .profile-button {
      position: relative;
      display: inline-block;
      cursor: pointer;
      padding: 8px 12px;
      background-color: #f2f2f2;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    .profile-button:hover {
      background-color: #e0e0e0;
    }

    .profile-dropdown {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 120px;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .profile-dropdown a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .profile-dropdown a:hover {
      background-color: #f1f1f1;
    }

    .profile-button:hover .profile-dropdown {
      display: block;
    }

    .navigation {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 20px;
    }

    .navigation a {
      margin-right: 10px;
      text-decoration: none;
      color: #333;
      padding: 8px 12px;
      border-radius: 4px;
      background-color: #f2f2f2;
      transition: background-color 0.3s ease;
    }

    .navigation a:hover {
      background-color: #e0e0e0;
    }

    .content {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 5px;
      display: none;
    }

    .content.active {
      display: block;
    }

    h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
    }

    .overlay-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="profile-button">
        Profile
        <div class="profile-dropdown">
          <a href="#" onclick="showAccountOverlay()">Account</a>
          <a href="{{ url_for('logout') }}">Logout</a>
        </div>
      </div>
    </header>

    <div class="navigation">
      <a href="#" onclick="showContent('events')">Events</a>
      <a href="#" onclick="showContent('requests')">Requests</a>
      <a href="#" onclick="showContent('eventsapplied')">Events Applied</a>
      <a href="#" onclick="showContent('notifications')">Notifications</a>
      <a href="#" onclick="showContent('remainders')">Remainders</a>
      
      
    </div>

    <div class="content" id="requests">
      <h2>Requests</h2>
      <table id="requests-table">
        <thead>
          <tr>
            <th>Event Name</th>
            <th>Event Time</th>
            <th>Event Venue</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- Requests table content will be added here -->
        </tbody>
      </table>
    </div>

    <div class="content" id="notifications">
      <h2>Notifications</h2>
      <ul id="notifications-list">
        <!-- Notifications section content will be added here -->
      </ul>
    </div>

    <div class="content" id="remainders">
      <h2>Reminders</h2>
      <ul id="reminder-list">
        <!-- Reminders will be dynamically added here -->
      </ul>
    </div>

    <div class="content" id="events">
      <h2>Events</h2>
      <ul>
          {% for event in events %}
          <li>Name:{{ event.event_name }}</li>
          <p>Description:{{ event.event_description }}</p>
          <p>Time: {{ event.event_time }}</p>
          <p>Duration: {{ event.event_duration }}</p>
          <p>Required Skills: {{ ', '.join(event.required_skills) }}</p>
          <p>Event Venue:{{ event.event_venue }}</p>
          {% if event.event_id not in applied_events and user_id not in event.suitablevolunteers %}
          <button class="applyButton" data-event-id="{{ event.event_id }}" id="apply">Apply</button>
          {% elif event.event_id not in applied_events and user_id in event.suitablevolunteers %}
          <span>You already got a request for this event.</span>
          {% else %}
          <span>Applied</span>
          {% endif %}
          <hr>
          {% endfor %}
      </ul>
  </div>
  
  

  <div class="content" id="eventsapplied">
    <h2>Events Applied</h2>
    <table>
      <thead>
        <tr>
          <th>Event Name</th>
          <th>Description</th>
          <th>Time</th>
          <th>Duration</th>
          <th>Required Skills</th>
          <th>Event Venue</th>
        </tr>
      </thead>
      <tbody id="eventsapplied-table-body">
        <!-- Table content will be added dynamically -->
      </tbody>
    </table>
  </div>
  

    <div class="overlay" id="accountOverlay">
      <div class="overlay-content">
        <h2>Account</h2>
        <p>Username: <span id="username"></span></p>
        <h3>Skills:</h3>
        <ul id="skillsList">
          <!-- Skills will be dynamically added here -->
        </ul>
        <h3>Available Time:</h3>
        <span id="availableTime"></span>
        <select id="timeSelect">
          <option value="9AM-12PM">9.00 AM - 12.00 PM</option>
          <option value="2PM-5PM">2.00 PM - 5.00 PM</option>
          <option value="6PM-10PM">6.00 PM - 10.00 PM</option>
        </select>
        <button onclick="updateAvailableTime()">Update Time</button>
        <button onclick="showSkillsOverlay()">+ Add Skills</button>
        <button class="close-button" onclick="closeAccountOverlay()">Close</button>
      </div>
    </div>

    <div class="overlay" id="skillsOverlay">
      <div class="overlay-content">
        <h2>Add Skills</h2>
        <p>Select your skills:</p>    
        <select id="skills" multiple>
          <option value="Creativity">Creativity</option>
          <option value="Communication">Communication</option>
          <option value="Mindfulness">Mindfulness</option>
          <option value="Metaconfigation">Metaconfigation</option>
          <option value="Leadership skills">Leadership skills</option>
          <option value="Fortitude">Fortitude</option>
          <option value="Creativity">Creativity</option>
          <option value="Metacognition">Metacognition</option>
          <option value="Coding skills">Coding skills</option>
          <option value="Sports">Sports</option>
          <option value="Positive attitude">Positive attitude</option>
        </select>
        <button onclick="saveSkills()">Save</button>
      </div>
    </div>

    <script>
      function showContent(contentId) {
        var contentSections = document.getElementsByClassName('content');
        for (var i = 0; i < contentSections.length; i++) {
          contentSections[i].classList.remove('active');
        }
        var selectedContent = document.getElementById(contentId);
        selectedContent.classList.add('active');
      }






      function showAccountOverlay() {
        var accountOverlay = document.getElementById('accountOverlay');
        accountOverlay.style.display = 'block';
        var skillsList = document.getElementById('skillsList');
        const user_id = window.location.href.split('/').pop().replace("#", "");

        fetch('/get_available_time/' + user_id)
      .then(response => response.json())
      .then(data => {
        var availableTimeElement = document.getElementById('availableTime');
        var availableTime = data.available_time;
        availableTimeElement.textContent = availableTime;
      })
      .catch(error => {
        console.error('An error occurred while fetching available time:', error);
        var availableTimeElement = document.getElementById('availableTime');
        availableTimeElement.textContent = 'Error fetching available time';
      });

// Fetch the volunteer's skills from the server
fetch('/get_skills/' + user_id)
  .then(response => response.json())
  .then(data => {
    var skills = data.skills;
    skillsList.innerHTML = ''; // Clear any existing skills

    if (skills.length > 0) {
      skills.forEach(skill => {
        var listItem = document.createElement('li');
        listItem.textContent = skill;
        skillsList.appendChild(listItem);
      });
    } else {
        var noSkillsMessage = document.createElement('li');
        noSkillsMessage.textContent = 'No skills found';
        skillsList.appendChild(noSkillsMessage);
      }
    })
    .catch(error => {
      console.error('An error occurred while fetching skills:', error);
      var errorMessage = document.createElement('li');
      errorMessage.textContent = 'Error fetching skills';
      skillsList.appendChild(errorMessage);
    });
  var usernameElement = document.getElementById('username');
  fetch('/get_username/' + user_id)
    .then(response => response.json())
    .then(data => {
      var username = data.username;
      usernameElement.textContent = username;
    })
    .catch(error => {
      console.error('An error occurred while fetching username:', error);
      usernameElement.textContent = 'Error fetching username';
    });
      }

      function showSkillsOverlay() {
        var skillsOverlay = document.getElementById('skillsOverlay');
        skillsOverlay.style.display = 'block';
      }
      function closeAccountOverlay() {
    var accountOverlay = document.getElementById('accountOverlay');
    accountOverlay.style.display = 'none';
  }

  function saveSkills() {
    var skillsSelect = document.getElementById('skills');
    var selectedSkills = Array.from(skillsSelect.selectedOptions, option => option.value);

    const user_id = window.location.href.split('/').pop().replace("#", "");

    fetch(`/update_skills/${user_id}`, {
      method: 'POST',
      body: JSON.stringify({ skills: selectedSkills }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        // Skills updated successfully
        // Perform any necessary actions here
        console.log('Skills updated successfully!');
        var skillsOverlay = document.getElementById('skillsOverlay');
        skillsOverlay.style.display = 'none';
      } else {
        // Skills update failed
        // Handle the error condition here, such as displaying an error message to the user
        console.error('Failed to update skills');
      }
    })
    .catch(error => {
      // Error occurred while updating skills
      console.error('An error occurred:', error);
    });
  }



  function updateAvailableTime() {
      var availableTimeSelect = document.getElementById('timeSelect');
      var selectedTime = Array.from(availableTimeSelect.selectedOptions, option => option.value);

      const user_id = window.location.href.split('/').pop().replace("#", "");

      fetch(`/update_available_time/${user_id}`, {
        method: 'POST',
        body: JSON.stringify({ available_time: selectedTime }),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
          if (response.ok) {
            // Available Time updated successfully
            // Perform any necessary actions here
            console.log('Available Time updated successfully!');
            var accountOverlay = document.getElementById('accountOverlay');
            accountOverlay.style.display = 'none';
          } 
          else {
            // Available Time update failed
            // Handle the error condition here, such as displaying an error message to the user
            console.error('Failed to update Available Time');
          }
        })
        .catch(error => {
          // Error occurred while updating Available Time
          console.error('An error occurred:', error);
        });
    }




  document.addEventListener('DOMContentLoaded', function () {
  const user_id = window.location.href.split('/').pop().replace("#", "");

  // Function to fetch and populate the Volunteer Requests table
  function fetchVolunteerRequests() {
    fetch(`/get_volunteer_requests/${user_id}`)
      .then(response => response.json())
      .then(data => {
        // Clear the table body
        var requestsTable = document.getElementById("requests-table").getElementsByTagName('tbody')[0];
        requestsTable.innerHTML = "";

        // Populate the table with fetched data
        data.requests.forEach(request => {
          var newRow = requestsTable.insertRow();
          newRow.innerHTML = `
            <td>${request.event_name}</td>
            <td>${request.event_time}</td>
            <td>${request.event_venue}</td>
            <td><button class="status-btn" data-event-id="${request.event_id}" data-status="${request.status}" ${request.status === 'Accepted' ? 'disabled' : ''}>${request.status}</button></td>
          `;
        });
        document.querySelectorAll('.status-btn').forEach(button => {
          button.addEventListener('click', function () {
            var eventId = this.getAttribute('data-event-id');
            var status = this.getAttribute('data-status');
            updateStatus(eventId, status);
          });
        });
      })
      .catch(error => {
        // Handle the error response (optional)
        console.log("Error:", error);
      });
  }

  // Fetch and populate the Volunteer Requests table on page load
  fetchVolunteerRequests();

  // Function to update the status and send a POST request to Flask
  function updateStatus(eventId, currentStatus) {
    var newStatus = currentStatus === 'Accept' ? 'Accepted' : 'Accept';

    fetch(`/update_status/${user_id}/${eventId}/${newStatus}`, {
      method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
      if (data.message === 'Success') {
        // Update the button text on a successful response
        document.querySelector(`.status-btn[data-event-id="${eventId}"]`).innerText = newStatus;
        document.querySelector(`.status-btn[data-event-id="${eventId}"]`).setAttribute('data-status', newStatus);
        document.querySelector(`.status-btn[data-event-id="${eventId}"]`).disabled = true;
      }
    })
    .catch(error => {
      // Handle the error response (optional)
      console.log("Error:", error);
    });
  }
});


  

  
  
    document.addEventListener('DOMContentLoaded', function () {
        const applyButtons = document.getElementsByClassName('applyButton');

        Array.from(applyButtons).forEach(button => {
            button.addEventListener('click', function () {
                const eventId = this.getAttribute('data-event-id');
                const userId = window.location.href.split('/').pop().replace("#", "");

                fetch(`/apply_to_event/${userId}/${eventId}`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Success') {
                        // Change the button text to 'Applied'
                        this.textContent = 'Applied';
                        this.disabled = true; // Disable the button to prevent multiple clicks
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            });
        });
    });



    document.addEventListener('DOMContentLoaded', function () {
  const user_id = window.location.href.split('/').pop().replace("#", "");

  // Function to fetch and populate notifications
  function fetchNotifications() {
    fetch(`/get_notifications_volunteer/${user_id}`)
      .then(response => response.json())
      .then(data => {
        const notificationsList = document.getElementById("notifications-list");
        notificationsList.innerHTML = "";

        data.notifications.forEach(notification => {
          const notificationItem = document.createElement("li");
          const event_name = notification.event_name;
          const volunteer_name = notification.volunteer_name;
          notificationItem.textContent = `Your skills and schedule matched with the event "${event_name}". You have been assigned to it as you accepted the request.`;
          notificationsList.appendChild(notificationItem);
        });
      })
      .catch(error => {
        console.error('Error:', error);
      });
  }

  // Fetch and populate notifications on page load
  fetchNotifications();
});




document.addEventListener('DOMContentLoaded', function () {
      const user_id = window.location.href.split('/').pop().replace("#", "");

      // Function to fetch and display reminders
      function fetchReminders() {
        fetch(`/get_volunteer_remainders/${user_id}`)
          .then(response => response.json())
          .then(data => {
            const reminderList = document.getElementById("reminder-list");

            data.remainders.forEach(reminder => {
              const event_name = reminder.event_name;
              const event_time = reminder.event_time;

              const li = document.createElement('li');
              li.textContent = `You have a request from the event "${event_name}" .`;
              reminderList.appendChild(li);
            });
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      // Fetch reminders on page load
      fetchReminders();
      setInterval(fetchReminders, 60000);
    });





  document.addEventListener('DOMContentLoaded', function () {
  const user_id = window.location.href.split('/').pop().replace("#", "");

  // Function to fetch and populate the applied events table
  function fetchAppliedEvents() {
    fetch(`/get_applied_events/${user_id}`)
      .then(response => response.json())
      .then(data => {
        // Clear the table body
        var eventsAppliedTable = document.getElementById("eventsapplied-table-body");
        eventsAppliedTable.innerHTML = "";

        // Populate the table with fetched data
        data.events.forEach(event => {
          var newRow = eventsAppliedTable.insertRow();
          newRow.innerHTML = `
            <td>${event.event_name}</td>
            <td>${event.event_description}</td>
            <td>${event.event_time}</td>
            <td>${event.event_duration}</td>
            <td>${event.required_skills.join(', ')}</td>
            <td>${event.event_venue}</td>
          `;
        });
      })
      .catch(error => {
        // Handle the error response (optional)
        console.log("Error:", error);
      });
  }

  // Fetch and populate the applied events table on page load
  fetchAppliedEvents();
});





    </script>
  </div>
</body>
</html>
